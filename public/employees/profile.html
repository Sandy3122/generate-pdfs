<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/W1qxgjkZ/logo.jpg">
    <!-- <script src="/js/customer/allScripts.js"></script> -->
    <link rel="stylesheet" href="/css/employeeProfileStyle.css">
    <title>Profile Page</title>
</head>

<body>
    <section class="section about-section light-bg" id="about">
        <div class="container">
            <div class="row align-items-center flex-row-reverse">
                <div class="col-6">
                    <div class="about-text go-to">
                        <h3 class="dark-color">Welcome <span id="firstName"></span></h3>
                        <h6 class="theme-color lead">Role: <span id="role"></span></h6>
                        <div class="row about-list">
                            <div class="col-6">
                                <div class="media">
                                    <label>Date Of Birth</label>
                                    <p id="dateOfBirth"></p>
                                </div>
                                <div class="media">
                                    <label>Age</label>
                                    <p id="age"></p>
                                </div>
                                <div class="media">
                                    <label>Marital Status</label>
                                    <p id="maritalStatus"></p>
                                </div>
                                <div class="media">
                                    <label>Gender</label>
                                    <p id="gender"></p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="media">
                                    <label>E-mail</label>
                                    <p id="email"></p>
                                </div>
                                <div class="media">
                                    <label>Phone</label>
                                    <p id="phoneNumber"></p>
                                </div>
                                <div class="media">
                                    <label>Emergency Phone</label>
                                    <p id="emergencyPhoneNumber"></p>
                                </div>
                                <div class="media">
                                    <label>Joining Date</label>
                                    <p id="joiningDate"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6 text-center">
                    <div class="about-avatar" id="avatarContainer">
                        <img id="profilePic" src="" title="userProfile" alt="">
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>
<!-- BootStrap CDN -->
<!-- MDB -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.20.0/pdf-lib.min.js"></script>
<script src="/js/loader.js"></script>
<script src="/js/customer/fetchUserData.js"></script>
<script src="/js/profile.js"></script>
<!-- <script>
    // profile.js
document.addEventListener('DOMContentLoaded', async function () {
    try {
        let token, userRole
        showLoader();
        const sessionData = await fetchSessionData();
        console.log(sessionData)
        hideLoader();
        if (sessionData) {
            token = sessionData.token;
            userRole = sessionData.role;
            console.log(token, userRole)
        }

        // Check if token or userRole is not available
        if (!token || !userRole) {
            throw new Error('No token or role found.');
        }

        const response = await fetch('/api/profile', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (!response.ok) {
            throw new Error('Failed to fetch profile.');
        }

        const data = await response.json();
        const user = data.user;

        // Update DOM elements with user data based on userRole
        if (userRole) {
            // Display admin profile details
            // Update DOM elements with user data
            document.getElementById('firstName').textContent = user.firstName;
            document.getElementById('role').textContent = user.role;
            document.getElementById('dateOfBirth').textContent = formatDate(user.dateOfBirth);
            document.getElementById('age').textContent = calculateAge(user.dateOfBirth)  + " years";
            document.getElementById('maritalStatus').textContent = user.maritalStatus;
            document.getElementById('gender').textContent = user.gender;
            document.getElementById('email').textContent = user.email;
            document.getElementById('phoneNumber').textContent = user.phoneNumber;
            document.getElementById('emergencyPhoneNumber').textContent = user.emergencyPhoneNumber;
            document.getElementById('joiningDate').textContent = formatJoiningDate(user.joiningDate);
            document.getElementById('profilePic').src = user.photoUrl ? user.photoUrl : "https://img.freepik.com/premium-vector/businessman-avatar-cartoon-character-profile_18591-50139.jpg";
            // Add other admin-specific fields here
        } else {
            // Handle invalid role
            console.error('Invalid user role:', userRole);
        }

    } catch (error) {
        console.error('Error fetching profile:', error);
        // Handle error, e.g., display error message to the user
    }
});

// Function to calculate age based on date of birth
function calculateAge(dateOfBirth) {
    const dob = new Date(dateOfBirth);
    const ageDiff = Date.now() - dob.getTime();
    const ageDate = new Date(ageDiff); // miliseconds from epoch
    return Math.abs(ageDate.getUTCFullYear() - 1970);
}

// Function to format date as "Month Day, Year"
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', options);
}

// Function to format joining date
function formatJoiningDate(joiningDateResponse) {
    // Check if the response is an object and contains the '_seconds' property
    if (typeof joiningDateResponse === 'object' && joiningDateResponse.hasOwnProperty('_seconds')) {
        // Extract the seconds part from the response
        const seconds = joiningDateResponse._seconds;

        // Convert seconds to milliseconds and create a Date object
        const date = new Date(seconds * 1000);

        // Format the date as "Month Day, Year" (e.g., "February 29, 2024")
        const formattedDate = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });

        return formattedDate;
    } else {
        return 'Invalid Date';
    }
}

 </script> -->
</html>  